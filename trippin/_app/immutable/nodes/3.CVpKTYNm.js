import{s as De,e as b,d as g,f as L,i as a,k,n as x,o as ye,t as O,b as E,p as se,h as P,j as C,q as K,l as u,m as U,r as W,v as Ee,w as ae,x as Ce,y as Re}from"../chunks/scheduler.CLQxmkvb.js";import{S as Te,i as ke,c as Se,b as $e,m as Le,t as He,a as we,d as Ie}from"../chunks/index.CixEVpcd.js";import{d as oe,l as Me,e as V,u as ce,c as ee,a as fe}from"../chunks/currencies.E13Mv77p.js";import{p as je}from"../chunks/stores.DX-hj_dL.js";function _e(r,t,e){const n=r.slice();return n[7]=t[e],n}function ue(r,t,e){const n=r.slice();return n[10]=t[e],n}function he(r,t,e){const n=r.slice();return n[7]=t[e],n}function te(r){const t=r.slice(),e=Array.from(new Set(t[2].map(n=>n.currency)));return t[6]=e,t}function de(r){let t,e=r[0].name+"",n,i,o,d=r[0].startDate.toDateString()+"",D,R,s=r[0].endDate.toDateString()+"",h,v,S,M="Receipt Summary",j,T,m=r[2]&&pe(te(r));return{c(){t=b("h1"),n=O(e),i=E(),o=b("h4"),D=O(d),R=O(" - "),h=O(s),v=E(),S=b("h5"),S.textContent=M,j=E(),m&&m.c(),T=se()},l(f){t=g(f,"H1",{});var p=L(t);n=P(p,e),p.forEach(a),i=C(f),o=g(f,"H4",{});var I=L(o);D=P(I,d),R=P(I," - "),h=P(I,s),I.forEach(a),v=C(f),S=g(f,"H5",{"data-svelte-h":!0}),K(S)!=="svelte-1hbjnf6"&&(S.textContent=M),j=C(f),m&&m.l(f),T=se()},m(f,p){k(f,t,p),u(t,n),k(f,i,p),k(f,o,p),u(o,D),u(o,R),u(o,h),k(f,v,p),k(f,S,p),k(f,j,p),m&&m.m(f,p),k(f,T,p)},p(f,p){p&1&&e!==(e=f[0].name+"")&&U(n,e),p&1&&d!==(d=f[0].startDate.toDateString()+"")&&U(D,d),p&1&&s!==(s=f[0].endDate.toDateString()+"")&&U(h,s),f[2]?m?m.p(te(f),p):(m=pe(te(f)),m.c(),m.m(T.parentNode,T)):m&&(m.d(1),m=null)},d(f){f&&(a(t),a(i),a(o),a(v),a(S),a(j),a(T)),m&&m.d(f)}}}function pe(r){let t,e,n="<tr><th>Receipt Description</th> <th>Receipt Date</th> <th>Receipt Type</th> <th>Receipt Total</th></tr>",i,o,d=[],D=new Map,R,s,h,v,S,M,j,T,m="<strong>Total</strong>",f,p,I,A,z,H,y="Receipt Images",N,w=[],Y=new Map,q,G,le=`// Wait for images to render before printing
        var imgs = document.images,
        len = imgs.length,
        counter = 0;

        [].forEach.call( imgs, function( img ) {
            if(img.complete)
              incrementCounter();
            else
              img.addEventListener( 'load', incrementCounter, false );
        } );

        function incrementCounter() {
            counter++;
            if ( counter === len ) {
              window.print();
            }
        }`,X=V(r[2]);const ne=l=>l[7].id;for(let l=0;l<X.length;l+=1){let _=he(r,X,l),c=ne(_);D.set(c,d[l]=me(c,_))}let Q=V(r[6]),$=[];for(let l=0;l<Q.length;l+=1)$[l]=ve(ue(r,Q,l));let Z=V(r[2]);const ie=l=>l[7].id;for(let l=0;l<Z.length;l+=1){let _=_e(r,Z,l),c=ie(_);Y.set(c,w[l]=be(c,_))}return{c(){t=b("table"),e=b("thead"),e.innerHTML=n,i=E(),o=b("tbody");for(let l=0;l<d.length;l+=1)d[l].c();R=E(),s=b("tfoot"),h=b("tr"),v=b("td"),S=E(),M=b("td"),j=E(),T=b("td"),T.innerHTML=m,f=E(),p=b("td");for(let l=0;l<$.length;l+=1)$[l].c();I=E(),A=b("td"),z=E(),H=b("h5"),H.textContent=y,N=E();for(let l=0;l<w.length;l+=1)w[l].c();q=E(),G=b("script"),G.textContent=le,this.h()},l(l){t=g(l,"TABLE",{class:!0});var _=L(t);e=g(_,"THEAD",{"data-svelte-h":!0}),K(e)!=="svelte-1yqevk1"&&(e.innerHTML=n),i=C(_),o=g(_,"TBODY",{});var c=L(o);for(let F=0;F<d.length;F+=1)d[F].l(c);c.forEach(a),R=C(_),s=g(_,"TFOOT",{class:!0});var J=L(s);h=g(J,"TR",{});var B=L(h);v=g(B,"TD",{}),L(v).forEach(a),S=C(B),M=g(B,"TD",{}),L(M).forEach(a),j=C(B),T=g(B,"TD",{class:!0,"data-svelte-h":!0}),K(T)!=="svelte-14afisz"&&(T.innerHTML=m),f=C(B),p=g(B,"TD",{});var re=L(p);for(let F=0;F<$.length;F+=1)$[F].l(re);re.forEach(a),I=C(B),A=g(B,"TD",{}),L(A).forEach(a),B.forEach(a),J.forEach(a),_.forEach(a),z=C(l),H=g(l,"H5",{"data-svelte-h":!0}),K(H)!=="svelte-1vv3lsi"&&(H.textContent=y),N=C(l);for(let F=0;F<w.length;F+=1)w[F].l(l);q=C(l),G=g(l,"SCRIPT",{"data-svelte-h":!0}),K(G)!=="svelte-tktxvg"&&(G.textContent=le),this.h()},h(){W(T,"class","text-end"),W(s,"class","table-group-divider"),W(t,"class","table table-striped table-hover")},m(l,_){k(l,t,_),u(t,e),u(t,i),u(t,o);for(let c=0;c<d.length;c+=1)d[c]&&d[c].m(o,null);u(t,R),u(t,s),u(s,h),u(h,v),u(h,S),u(h,M),u(h,j),u(h,T),u(h,f),u(h,p);for(let c=0;c<$.length;c+=1)$[c]&&$[c].m(p,null);u(h,I),u(h,A),k(l,z,_),k(l,H,_),k(l,N,_);for(let c=0;c<w.length;c+=1)w[c]&&w[c].m(l,_);k(l,q,_),k(l,G,_)},p(l,_){if(_&4&&(X=V(l[2]),d=ce(d,_,ne,1,l,X,D,o,fe,me,null,he)),_&4){Q=V(l[6]);let c;for(c=0;c<Q.length;c+=1){const J=ue(l,Q,c);$[c]?$[c].p(J,_):($[c]=ve(J),$[c].c(),$[c].m(p,null))}for(;c<$.length;c+=1)$[c].d(1);$.length=Q.length}_&4&&(Z=V(l[2]),w=ce(w,_,ie,1,l,Z,Y,q.parentNode,fe,be,q,_e))},d(l){l&&(a(t),a(z),a(H),a(N),a(q),a(G));for(let _=0;_<d.length;_+=1)d[_].d();Ee($,l);for(let _=0;_<w.length;_+=1)w[_].d(l)}}}function me(r,t){let e,n,i=t[7].description+"",o,d,D,R=t[7].receiptDate.toDateString()+"",s,h,v,S=t[7].receiptType+"",M,j,T,m=ee[t[7].currency].symbol+"",f,p,I=t[7].total.toFixed(2)+"",A,z;return{key:r,first:null,c(){e=b("tr"),n=b("td"),o=O(i),d=E(),D=b("td"),s=O(R),h=E(),v=b("td"),M=O(S),j=E(),T=b("td"),f=O(m),p=E(),A=O(I),z=E(),this.h()},l(H){e=g(H,"TR",{});var y=L(e);n=g(y,"TD",{});var N=L(n);o=P(N,i),N.forEach(a),d=C(y),D=g(y,"TD",{});var w=L(D);s=P(w,R),w.forEach(a),h=C(y),v=g(y,"TD",{});var Y=L(v);M=P(Y,S),Y.forEach(a),j=C(y),T=g(y,"TD",{});var q=L(T);f=P(q,m),p=C(q),A=P(q,I),q.forEach(a),z=C(y),y.forEach(a),this.h()},h(){this.first=e},m(H,y){k(H,e,y),u(e,n),u(n,o),u(e,d),u(e,D),u(D,s),u(e,h),u(e,v),u(v,M),u(e,j),u(e,T),u(T,f),u(T,p),u(T,A),u(e,z)},p(H,y){t=H,y&4&&i!==(i=t[7].description+"")&&U(o,i),y&4&&R!==(R=t[7].receiptDate.toDateString()+"")&&U(s,R),y&4&&S!==(S=t[7].receiptType+"")&&U(M,S),y&4&&m!==(m=ee[t[7].currency].symbol+"")&&U(f,m),y&4&&I!==(I=t[7].total.toFixed(2)+"")&&U(A,I)},d(H){H&&a(e)}}}function ve(r){let t=ee[r[10]].symbol+"",e,n,i=r[2].filter(R).reduce(ge,0).toFixed(2)+"",o,d,D;function R(...s){return r[3](r[10],...s)}return{c(){e=O(t),n=E(),o=O(i),d=E(),D=b("br")},l(s){e=P(s,t),n=C(s),o=P(s,i),d=C(s),D=g(s,"BR",{})},m(s,h){k(s,e,h),k(s,n,h),k(s,o,h),k(s,d,h),k(s,D,h)},p(s,h){r=s,h&4&&t!==(t=ee[r[10]].symbol+"")&&U(e,t),h&4&&i!==(i=r[2].filter(R).reduce(ge,0).toFixed(2)+"")&&U(o,i)},d(s){s&&(a(e),a(n),a(o),a(d),a(D))}}}function be(r,t){let e,n;return{key:r,first:null,c(){e=b("img"),this.h()},l(i){e=g(i,"IMG",{class:!0,src:!0}),this.h()},h(){W(e,"class","img-fluid"),ae(e.src,n=URL.createObjectURL(t[7].imageData))||W(e,"src",n),this.first=e},m(i,o){k(i,e,o)},p(i,o){t=i,o&4&&!ae(e.src,n=URL.createObjectURL(t[7].imageData))&&W(e,"src",n)},d(i){i&&a(e)}}}function qe(r){let t,e=r[0]&&de(r);return{c(){t=b("div"),e&&e.c()},l(n){t=g(n,"DIV",{});var i=L(t);e&&e.l(i),i.forEach(a)},m(n,i){k(n,t,i),e&&e.m(t,null)},p(n,[i]){n[0]?e?e.p(n,i):(e=de(n),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},i:x,o:x,d(n){n&&a(t),e&&e.d()}}}const ge=(r,t)=>r+t.total;function Fe(r,t,e){let n,i,o=x,d=()=>(o(),o=Ce(s,v=>e(2,i=v)),s);ye(r,je,v=>e(4,n=v)),r.$$.on_destroy.push(()=>o());let D=parseInt(n.url.searchParams.get("tripId")||"-1"),R,s;return D>-1&&oe.trips.get(D).then(v=>{e(0,R=v),d(e(1,s=Me(()=>oe.receipts.where({tripId:D}).reverse().sortBy("receiptDate"))))}),[R,s,i,(v,S)=>S.currency==v]}class Oe extends Te{constructor(t){super(),ke(this,t,Fe,qe,De,{})}}function Pe(r){let t,e,n;return e=new Oe({}),{c(){t=E(),Se(e.$$.fragment),this.h()},l(i){Re("svelte-17j05zq",document.head).forEach(a),t=C(i),$e(e.$$.fragment,i),this.h()},h(){document.title="Trippin' | Print/Export"},m(i,o){k(i,t,o),Le(e,i,o),n=!0},p:x,i(i){n||(He(e.$$.fragment,i),n=!0)},o(i){we(e.$$.fragment,i),n=!1},d(i){i&&a(t),Ie(e,i)}}}class Ne extends Te{constructor(t){super(),ke(this,t,null,Pe,De,{})}}export{Ne as component};
